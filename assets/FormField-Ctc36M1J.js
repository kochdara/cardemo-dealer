var ie=Object.defineProperty;var le=(e,t,r)=>t in e?ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var L=(e,t,r)=>le(e,typeof t!="symbol"?t+"":t,r);import{aP as oe,r as E,W as g,a8 as ue,ac as de,e as Z,k as v,w as X,$ as h,a0 as ce,g as b,a1 as ae,Y as R,X as re,aW as se,aX as ne,aY as Q,aS as F,o as _,aZ as fe,ao as ee,aR as me,a_ as T,a$ as pe,b0 as ye,aw as ve,q as f,al as he,b1 as be,at as ge,b2 as we,a as te,c as W,f as U,b as Se,s as Y,t as J,b3 as qe}from"./index-BKCPoiO_.js";function Je(e){const t=oe({dir:E("ltr")});return g(()=>{var r;return(e==null?void 0:e.value)||((r=t.dir)==null?void 0:r.value)||"ltr"})}const xe=ue({__name:"Label",props:{for:{},asChild:{type:Boolean},as:{default:"label"}},setup(e){const t=e;return de(),(r,s)=>(v(),Z(b(ae),ce(t,{onMousedown:s[0]||(s[0]=i=>{!i.defaultPrevented&&i.detail>1&&i.preventDefault()})}),{default:X(()=>[h(r.$slots,"default")]),_:3},16))}});function Ie(e){return e.validate&&e.__isYupSchema__}function Ee(e){return e.inner!==void 0}function Fe(e){return"schema"in e&&typeof e.coercer=="function"&&typeof e.validator=="function"&&typeof e.refiner=="function"}function $e(e){return e.validateAsync!==void 0&&e.id!==void 0}function je(e){return e.isJoi===!0}function Be(e){return"~standard"in e}async function Oe(e,t){var s;const r=await t["~standard"].validate(e);return r.issues?{errors:((s=r.issues)==null?void 0:s.map(i=>{var d;return{name:((d=i.path)==null?void 0:d.map(u=>typeof u=="object"?u.key:u).join("."))||"",message:i.message}}))||[],result:null}:{errors:null,result:r.value}}async function Pe(e,t){try{return{errors:null,result:await t.validate(e,{abortEarly:!1})}}catch(r){if(Ee(r))return{errors:r.inner.map(i=>({name:i.path??"",message:i.message})),result:null};throw r}}async function ke(e,t){const[r,s]=t.validate(e);return r?{errors:r.failures().map(d=>({message:d.message,name:d.path.join(".")})),result:null}:{errors:null,result:s}}async function Ce(e,t){try{return{errors:null,result:await t.validateAsync(e,{abortEarly:!1})}}catch(r){if(je(r))return{errors:r.details.map(i=>({name:i.path.join("."),message:i.message})),result:null};throw r}}function De(e,t){if(Be(t))return Oe(e,t);if($e(t))return Ce(e,t);if(Ie(t))return Pe(e,t);if(Fe(t))return ke(e,t);throw new Error("Form validation failed: Unsupported form schema")}class M extends Error{constructor(r,s,i){super("Form validation exception");L(this,"formId");L(this,"errors");L(this,"children");this.formId=r,this.errors=s,this.children=i,Object.setPrototypeOf(this,M.prototype)}}const ze={base:""},Me={__name:"Form",props:{id:{type:[String,Number],required:!1},schema:{type:null,required:!1},state:{type:Object,required:!0},validate:{type:Function,required:!1},validateOn:{type:Array,required:!1,default(){return["input","blur","change"]}},disabled:{type:Boolean,required:!1},validateOnInputDelay:{type:Number,required:!1,default:300},transform:{type:Boolean,required:!1,default:!0},attach:{type:Boolean,required:!1,default:!0},loadingAuto:{type:Boolean,required:!1,default:!0},class:{type:null,required:!1},onSubmit:{type:Function,required:!1}},emits:["submit","error"],setup(e,{expose:t,emit:r}){const s=e,i=r,d=re(),u=g(()=>{var a;return R({extend:R(ze),...((a=d.ui)==null?void 0:a.form)||{}})}),m=s.id??se(),p=fe(`form-${m}`),o=s.attach&&ne(Q,void 0);F(Q,p);const w=E(new Map);_(async()=>{p.on(async a=>{var n;a.type==="attach"?w.value.set(a.formId,{validate:a.validate}):a.type==="detach"?w.value.delete(a.formId):(n=s.validateOn)!=null&&n.includes(a.type)&&!B.value&&(a.type!=="input"?await y({name:a.name,silent:!0,nested:!1}):(a.eager||$.has(a.name))&&await y({name:a.name,silent:!0,nested:!1})),a.type==="blur"&&$.add(a.name),(a.type==="change"||a.type==="input"||a.type==="blur"||a.type==="focus")&&O.add(a.name),(a.type==="change"||a.type==="input")&&q.add(a.name)})}),ee(()=>{p.reset()}),_(async()=>{o&&(await me(),o.emit({type:"attach",validate:y,formId:m}))}),ee(()=>{o&&o.emit({type:"detach",formId:m})});const l=E([]);F("form-errors",l);const S=E({});F(be,S);const q=new Set,O=new Set,$=new Set;function j(a){return a.map(n=>{var c;return{...n,id:n!=null&&n.name?(c=S.value[n.name])==null?void 0:c.id:void 0}})}const P=E(null);async function k(){let a=s.validate?await s.validate(s.state)??[]:[];if(s.schema){const{errors:n,result:c}=await De(s.state,s.schema);n?a=a.concat(n):P.value=c}return j(a)}async function y(a={silent:!1,nested:!0,transform:!1}){const n=a.name&&!Array.isArray(a.name)?[a.name]:a.name,c=!n&&a.nested?Array.from(w.value.values()).map(({validate:I})=>I(a).then(()=>{}).catch(C=>{if(!(C instanceof M))throw C;return C})):[];if(n){const I=l.value.filter(D=>!n.some(z=>{var V,N,K;const A=(N=(V=S.value)==null?void 0:V[z])==null?void 0:N.pattern;return z===D.name||A&&((K=D.name)==null?void 0:K.match(A))})),C=(await k()).filter(D=>n.some(z=>{var V,N,K;const A=(N=(V=S.value)==null?void 0:V[z])==null?void 0:N.pattern;return z===D.name||A&&((K=D.name)==null?void 0:K.match(A))}));l.value=I.concat(C)}else l.value=await k();const x=(await Promise.all(c)).filter(I=>I!==void 0);if(l.value.length+x.length>0){if(a.silent)return!1;throw new M(m,l.value,x)}return a.transform&&Object.assign(s.state,P.value),s.state}const B=E(!1);F(pe,T(B));async function G(a){var c;B.value=s.loadingAuto&&!0;const n=a;try{n.data=await y({nested:!0,transform:s.transform}),await((c=s.onSubmit)==null?void 0:c.call(s,n)),q.clear()}catch(x){if(!(x instanceof M))throw x;const I={...n,errors:x.errors,children:x.children};i("error",I)}finally{B.value=!1}}const H=g(()=>s.disabled||B.value);return F(ye,g(()=>({disabled:H.value,validateOnInputDelay:s.validateOnInputDelay}))),t({validate:y,errors:l,setErrors(a,n){n?l.value=l.value.filter(c=>c.name!==n).concat(j(a)):l.value=j(a)},async submit(){await G(new Event("submit"))},getErrors(a){return a?l.value.filter(n=>n.name===a):l.value},clear(a){a?l.value=l.value.filter(n=>n.name!==a):l.value=[]},disabled:H,loading:B,dirty:g(()=>!!q.size),dirtyFields:T(q),blurredFields:T($),touchedFields:T(O)}),(a,n)=>(v(),Z(he(b(o)?"div":"form"),{id:b(m),class:f(u.value({class:s.class})),onSubmit:ve(G,["prevent"])},{default:X(()=>[h(a.$slots,"default",{errors:l.value})]),_:3},40,["id","class"]))}},Ae={slots:{root:"",wrapper:"",labelWrapper:"flex content-center items-center justify-between",label:"block font-medium text-default",container:"mt-1 relative",description:"text-muted",error:"mt-2 text-error",hint:"text-muted",help:"mt-2 text-muted"},variants:{size:{xs:{root:"text-xs"},sm:{root:"text-xs"},md:{root:"text-sm"},lg:{root:"text-sm"},xl:{root:"text-base"}},required:{true:{label:"after:content-['*'] after:ms-0.5 after:text-error"}}},defaultVariants:{size:"md"}},Ve=["id"],Ne=["id"],Ke=["id"],Le={__name:"FormField",props:{as:{type:null,required:!1},name:{type:String,required:!1},errorPattern:{type:null,required:!1},label:{type:String,required:!1},description:{type:String,required:!1},help:{type:String,required:!1},error:{type:[String,Boolean],required:!1},hint:{type:String,required:!1},size:{type:null,required:!1},required:{type:Boolean,required:!1},eagerValidation:{type:Boolean,required:!1},validateOnInputDelay:{type:Number,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(e){const t=e,r=ge(),s=re(),i=g(()=>{var o;return R({extend:R(Ae),...((o=s.ui)==null?void 0:o.formField)||{}})({size:t.size,required:t.required})}),d=ne("form-errors",null),u=g(()=>{var o,w;return t.error||((w=(o=d==null?void 0:d.value)==null?void 0:o.find(l=>l.name&&(l.name===t.name||t.errorPattern&&l.name.match(t.errorPattern))))==null?void 0:w.message)}),m=E(se()),p=m.value;return F(qe,m),F(we,g(()=>({error:u.value,name:t.name,size:t.size,eagerValidation:t.eagerValidation,validateOnInputDelay:t.validateOnInputDelay,errorPattern:t.errorPattern,hint:t.hint,description:t.description,help:t.help,ariaId:p}))),(o,w)=>{var l;return v(),Z(b(ae),{as:e.as,class:f(i.value.root({class:[(l=t.ui)==null?void 0:l.root,t.class]}))},{default:X(()=>{var S,q,O,$,j,P,k,y;return[te("div",{class:f(i.value.wrapper({class:(S=t.ui)==null?void 0:S.wrapper}))},[e.label||r.label?(v(),W("div",{key:0,class:f(i.value.labelWrapper({class:(q=t.ui)==null?void 0:q.labelWrapper}))},[Se(b(xe),{for:m.value,class:f(i.value.label({class:(O=t.ui)==null?void 0:O.label}))},{default:X(()=>[h(o.$slots,"label",{label:e.label},()=>[Y(J(e.label),1)])]),_:3},8,["for","class"]),e.hint||r.hint?(v(),W("span",{key:0,id:`${b(p)}-hint`,class:f(i.value.hint({class:($=t.ui)==null?void 0:$.hint}))},[h(o.$slots,"hint",{hint:e.hint},()=>[Y(J(e.hint),1)])],10,Ve)):U("",!0)],2)):U("",!0),e.description||r.description?(v(),W("p",{key:1,id:`${b(p)}-description`,class:f(i.value.description({class:(j=t.ui)==null?void 0:j.description}))},[h(o.$slots,"description",{description:e.description},()=>[Y(J(e.description),1)])],10,Ne)):U("",!0)],2),te("div",{class:f([(e.label||!!r.label||e.description||!!r.description)&&i.value.container({class:(P=t.ui)==null?void 0:P.container})])},[h(o.$slots,"default",{error:u.value}),typeof u.value=="string"&&u.value||r.error?(v(),W("div",{key:0,id:`${b(p)}-error`,class:f(i.value.error({class:(k=t.ui)==null?void 0:k.error}))},[h(o.$slots,"error",{error:u.value},()=>[Y(J(u.value),1)])],10,Ke)):e.help||r.help?(v(),W("div",{key:1,class:f(i.value.help({class:(y=t.ui)==null?void 0:y.help}))},[h(o.$slots,"help",{help:e.help},()=>[Y(J(e.help),1)])],2)):U("",!0)],2)]}),_:3},8,["as","class"])}}};export{Me as _,Le as a,Je as u};
